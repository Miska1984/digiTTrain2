<div class="report-container">
    <div class="header-section">
        <h1 class="text-primary">Testtartás Elemzési Riport</h1>
        <div class="athlete-info">
            <p><strong>Sportoló neve:</strong> {{ full_name }}</p>
            <p><strong>Mérés dátuma:</strong> {{ date }}</p>
        </div>
    </div>

   <div class="score-box text-center" style="background: #f0f7ff; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 2px solid #0d6efd;">
        <h2 style="margin: 0; color: #003366; font-size: 18px;">POSTURE SCORE</h2>
        <div style="font-size: 64px; font-weight: bold; color: #0d6efd; margin: 10px 0;">
            {# Az új, közvetlen változót használjuk #}
            {{ posture_score|default:"--" }}
        </div>
        <p style="margin: 0; color: #666; font-size: 12px;">Computer Vision alapú statikus aszimmetria vizsgálat</p>
    </div>

    <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
        <thead>
            <tr style="background-color: #343a40; color: white;">
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Paraméter</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: center;">Mért érték</th>
                <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">Diagnózis</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;"><strong>Váll dőlésszöge</strong></td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ analysis.metrics.average_shoulder_tilt }}°</td>
                <td style="padding: 10px; border: 1px solid #ddd;">{% if analysis.metrics.average_shoulder_tilt > 3 %}Aszimmetria észlelhető{% else %}Optimális{% endif %}</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;"><strong>Medence dőlése</strong></td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ analysis.metrics.average_hip_tilt }}°</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Végtaghossz vagy medence csavarodás jele.</td>
            </tr>
            <tr>
                <td style="padding: 10px; border: 1px solid #ddd;"><strong>Súlypont eltolódás</strong></td>
                <td style="padding: 10px; border: 1px solid #ddd; text-align: center;">{{ analysis.metrics.average_lateral_shift|floatformat:2 }}</td>
                <td style="padding: 10px; border: 1px solid #ddd;">Oldalirányú terhelés dominanciája.</td>
            </tr>
        </tbody>
    </table>

    <div style="display: flex; margin-top: 30px; gap: 20px;">
        {% if analysis.metrics.shoulder_snapshot_url or analysis.shoulder_snapshot_url %}
        <div style="flex: 1; text-align: center;">
            <p style="font-weight: bold; font-size: 12px;">Váll aszimmetria snapshot</p>
            <img src="{{ analysis.shoulder_snapshot_url|default:analysis.metrics.shoulder_snapshot_url }}" style="width: 100%; border-radius: 8px; border: 1px solid #ddd;">
        </div>
        {% endif %}
        {% if analysis.metrics.hip_snapshot_url or analysis.hip_snapshot_url %}
        <div style="flex: 1; text-align: center;">
            <p style="font-weight: bold; font-size: 12px;">Csípő aszimmetria snapshot</p>
            <img src="{{ analysis.hip_snapshot_url|default:analysis.metrics.hip_snapshot_url }}" style="width: 100%; border-radius: 8px; border: 1px solid #ddd;">
        </div>
        {% endif %}
    </div>

    {% if analysis.feedback %}
    <div style="margin-top: 30px; padding: 15px; background: #fff3cd; border-left: 5px solid #ffc107;">
        <h5 style="margin-top: 0;">Ditta szakmai javaslatai:</h5>
        <ul style="margin-bottom: 0;">
            {% for msg in analysis.feedback %}
                <li>{{ msg }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</div>