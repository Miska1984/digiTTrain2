{% load static %}
{% load user_extras %}
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}digiTTrain{% endblock %}</title>

    <!-- Frameworkek -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7737967729637742"
     crossorigin="anonymous"></script>

    {% block extra_css %}{% endblock %}
</head>

<body>
<header class="p-3 bg-dark text-white shadow">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
            <!-- LOGO -->
            <a class="navbar-brand d-flex align-items-center text-white text-decoration-none" href="{% url 'core:main_page' %}">
                <img src="{% static 'images/your_logo.png' %}" alt="Logo" style="height: 50px;">
                <span class="ms-2 fw-bold"></span>
            </a>

            <!-- NAVIGÁCIÓ -->
            <ul class="nav mb-2 justify-content-center mb-md-0">

                <!-- VEZÉRLŐPULT -->
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="mainDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-cogs me-1"></i> Vezérlőpult
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'users:role_dashboard' %}">Szerepkörök kezelése</a></li>
                        <li><a class="dropdown-item" href="{% url 'users:pending_roles' %}">Jóváhagyások</a></li>
                        <li><a class="dropdown-item" href="{% url 'data_sharing:sharing_center' %}">Megosztási központ</a></li>
                    </ul>
                </li>

                <!-- SPORTOLÓ FUNKCIÓK -->
                {% if request.user|has_role:"Sportoló" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="athleteDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-running me-1"></i> Sportoló
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'biometric_data:athlete_dashboard' %}">Adat Összefoglaló</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:morning_check' %}">Reggeli mérések</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:after_training' %}">Esti mérések</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:occasional_measurements' %}">Eseti mérések</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:add_running_performance' %}">Futás teljesítmény</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- SZÜLŐ FUNKCIÓK -->
                {% if request.user|has_role:"Szülő" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="parentDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-child me-1"></i> Szülő
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'data_sharing:parent_dashboard' %}">Gyermek(ek) adatai</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- EDZŐ FUNKCIÓK -->
                {% if request.user|has_role:"Edző" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="coachDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-tie me-1"></i> Edző
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'data_sharing:add_unregistered_athlete' %}">Sportoló felvitele</a></li>
                        <li><a class="dropdown-item" href="{% url 'data_sharing:coach_dashboard' %}">Sportolóim</a></li>
                        <li><a class="dropdown-item" href="{% url 'data_sharing:manage_schedules' %}">Edzés tervezés</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- EGYESÜLETI VEZETŐ FUNKCIÓK -->
                {% if request.user|has_role:"Egyesületi vezető" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="leaderDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-crown me-1"></i> Egyesületi Vezető
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'data_sharing:leader_dashboard' %}">Biometrikus adatok</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- GÉPI LÁTÁS FUNKCIÓK (csak Sportoló) -->
                {% if request.user|has_any_role:"Sportoló,Edző,Szülő,Egyesületi vezető" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="diagnosticsDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-eye me-1"></i> Gépi látás
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li>
                            <a class="dropdown-item" href="{% url 'diagnostics:athlete_diagnostics' %}">
                                <i class="fas fa-brain me-2 text-info"></i> Általános elemzés
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'diagnostics:upload_general_video' %}">
                                <i class="fas fa-video me-2 text-success"></i> Általános elemzés (videó feltöltése lenne de már nem kell)
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item disabled text-muted" href="#">
                                <i class="fas fa-dumbbell me-2"></i> Sportspecifikus elemzések (fejlesztés alatt)
                            </a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                <!-- PÉNZÜGYEK -->
                {% if request.user|has_any_role:"Sportoló,Edző,Szülő,Egyesületi vezető" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="billingDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-wallet me-1"></i> Pénzügyek
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'billing_dashboard' %}">Pénzügyi vezérlőpult</a></li>
                        <li><a class="dropdown-item" href="{% url 'billing_top_up' %}">Credit feltöltés / Számla</a></li>
                        <li><a class="dropdown-item" href="{% url 'ad_credit_earn' %}">Credit szerzés (Hirdetés)</a></li>
                    </ul>
                </li>
                {% endif %}
            </ul>

            <!-- PROFIL + KIJELENTKEZÉS -->
            <div class="text-end d-flex align-items-center">
                <a href="{% url 'users:edit_profile' %}" class="nav-link text-white me-3">
                    <i class="bi bi-person-circle h4"></i>
                </a>
                <form action="{% url 'users:logout' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-light me-2">Kijelentkezés</button>
                </form>
            </div>
        </div>
    </div>
</header>

<!-- ÜZENETEK -->
{% if messages %}
<div class="container mt-2">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
</div>
{% endif %}

<!-- TARTALOM -->
<main class="container py-4">
    <div class="row">
        <div class="col-lg-9 col-md-8">{% block content %}{% endblock %}</div>
        <div class="col-lg-3 col-md-4 mt-4 mt-md-0">{% include 'billing/includes/ad_sidebar.html' %}</div>
    </div>
</main>

<footer class="py-3 my-4">
    {% include 'billing/includes/ad_footer.html' %}
    <p class="text-center text-muted">© 2025 digiTTrain</p>
</footer>

<!-- JS -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

{% block extra_js %}{% endblock %}
</body>
</html>
