{% load static %}
{% load user_extras %}
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}digiTTrain{% endblock %}</title>

    <!-- Frameworkek -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    {% if not is_ad_free %}
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7737967729637742"
     crossorigin="anonymous"></script>
    {% endif %}

    {% block extra_css %}{% endblock %}
</head>

<body>
<header class="p-3 bg-dark text-white shadow">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
            <!-- LOGO -->
            <a class="navbar-brand d-flex align-items-center text-white text-decoration-none" href="{% url 'core:main_page' %}">
                <img src="{% static 'images/your_logo.png' %}" alt="Logo" style="height: 50px;">
                <span class="ms-2 fw-bold"></span>
            </a>

            <!-- NAVIG√ÅCI√ì -->
            <ul class="nav mb-2 justify-content-center mb-md-0">

                <!-- VEZ√âRL≈êPULT -->
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="mainDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-sliders-h me-1"></i> Vez√©rl≈ëpult
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark shadow">
                        <li>
                            <a class="dropdown-item" href="{% url 'users:role_dashboard' %}">
                                <i class="fas fa-user-tag me-2 text-info"></i>Szerepk√∂r√∂k kezel√©se
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'users:pending_roles' %}">
                                <i class="fas fa-user-clock me-2 text-warning"></i>J√≥v√°hagy√°sok
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'data_sharing:sharing_center' %}">
                                <i class="fas fa-share-alt me-2 text-success"></i>Megoszt√°si k√∂zpont
                            </a>
                        </li>
                    </ul>
                </li>

                <!-- SPORTOL√ì FUNKCI√ìK -->
                {% if request.user|has_role:"Sportol√≥" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="athleteDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-running me-1"></i> Sportol√≥
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'biometric_data:athlete_dashboard' %}">
                            <i class="fas fa-tachometer-alt me-2 text-primary"></i>Adat √ñsszefoglal√≥</a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:morning_check' %}">
                            <i class="fas fa-sun me-2 text-warning"></i>Reggeli m√©r√©sek</a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:after_training' %}">
                            <i class="fas fa-moon me-2 text-secondary"></i>Esti m√©r√©sek</a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:occasional_measurements' %}">
                            <i class="fas fa-database me-2 text-info"></i>Eseti m√©r√©sek</a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:add_running_performance' %}">
                            <i class="fas fa-chart-line me-2 text-success"></i>Fut√°s teljes√≠tm√©ny</a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'ml_engine:dashboard' %}">
                                <i class="fas fa-magic me-2 text-warning"></i> Forma El≈ërejelz√©s
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'diagnostics:athlete_diagnostics' %}">
                                <i class="fas fa-brain me-2 text-info"></i> √Åltal√°nos elemz√©s
                            </a>
                        </li>
                        <li><a class="dropdown-item" href="{% url 'diagnostics_jobs:anthropometry_profile_view' %}">
                                <i class="fas fa-ruler-combined me-2 text-light"></i> Antropometriai Profil
                            </a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                <!-- SZ√úL≈ê FUNKCI√ìK -->
                {% if request.user|has_role:"Sz√ºl≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="parentDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-friends me-1"></i> Sz√ºl≈ë
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li>
                            <a class="dropdown-item" href="{% url 'data_sharing:parent_dashboard' %}">
                                <i class="fas fa-chart-pie me-2 text-info"></i>Gyermek(ek) adatai
                            </a>
                        </li>
                        
                        {% if pending_child_approvals_count > 0 %}
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item" href="{% url 'users:pending_roles' %}">
                                <i class="fas fa-user-check me-2 text-warning"></i>J√≥v√°hagy√°s v√°r ({ { pending_child_approvals_count } })
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                {% endif %}

                
                <!-- EDZ≈ê FUNKCI√ìK -->
                {% if request.user|has_role:"Edz≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="coachDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-chalkboard-teacher me-1"></i> Edz≈ë
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark shadow">
                        <li>
                            <a class="dropdown-item" href="{% url 'data_sharing:coach_dashboard' %}">
                                <i class="fas fa-users me-2 text-primary"></i>Sportol√≥im
                            </a>
                        </li>

                        <li>
                            <a class="dropdown-item" href="{% url 'data_sharing:manage_schedules' %}">
                                <i class="fas fa-calendar-alt me-2 text-success"></i>Edz√©s tervez√©s
                            </a>
                        </li>

                        <li><hr class="dropdown-divider opacity-20"></li>

                        <li>
                            <a class="dropdown-item" href="{% url 'data_sharing:add_unregistered_athlete' %}">
                                <i class="fas fa-user-plus me-2 text-info"></i>Sportol√≥ felvitele
                            </a>
                        </li>

                        {% if pending_roles_count > 0 %}
                        <li>
                            <a class="dropdown-item" href="{% url 'users:pending_roles' %}">
                                <i class="fas fa-bell me-2 text-warning"></i>J√≥v√°hagy√°sok 
                                <span class="badge rounded-pill bg-danger ms-1">{{ pending_roles_count }}</span>
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </li>
                {% endif %}
                

                <!-- EGYES√úLETI VEZET≈ê FUNKCI√ìK -->
                {% if request.user|has_role:"Egyes√ºleti vezet≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="leaderDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-crown me-1 text-warning"></i> Egyes√ºleti Vezet≈ë
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark shadow">
                        <li>
                            <a class="dropdown-item" href="{% url 'data_sharing:leader_dashboard' %}">
                                <i class="fas fa-chart-line me-2 text-success"></i>Szervezeti adatok
                            </a>
                        </li>

                        <li><hr class="dropdown-divider opacity-20"></li>

                        <li>
                            <a class="dropdown-item" href="{% url 'users:pending_roles' %}">
                                <i class="fas fa-clipboard-check me-2 text-info"></i>Tags√°gok kezel√©se
                                {% if pending_roles_count > 0 %}
                                    <span class="badge rounded-pill bg-danger ms-1">{{ pending_roles_count }}</span>
                                {% endif %}
                            </a>
                        </li>

                        <li>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-cogs me-2 text-secondary"></i>Egyes√ºleti profil
                            </a>
                        </li>
                    </ul>
                </li>
                {% endif %}



                <!-- P√âNZ√úGYEK -->
                {% if request.user|has_any_role:"Sportol√≥,Edz≈ë,Sz√ºl≈ë,Egyes√ºleti vezet≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="billingDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-wallet me-1 text-success"></i> P√©nz√ºgyek
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark shadow">
                        <li>
                            <a class="dropdown-item" href="{% url 'billing:billing_dashboard' %}">
                                <i class="fas fa-file-invoice-dollar me-2 text-info"></i>P√©nz√ºgyi vez√©rl≈ëpult
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'billing:billing_purchase' %}">
                                <i class="fas fa-shopping-cart me-2 text-primary"></i>V√°s√°rl√°s
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'billing:ad_credit_earn' %}">
                                <i class="fas fa-coins me-2 text-warning"></i>Kredit Szerz√©s
                            </a>
                        </li>
                    </ul>
                </li>
                {% endif %}
            </ul>

            <!-- PROFIL + KIJELENTKEZ√âS -->
            <div class="text-end d-flex align-items-center">
                <a href="{% url 'users:edit_profile' %}" class="nav-link text-white me-3">
                    <i class="bi bi-person-circle h4"></i>
                </a>
                <form action="{% url 'users:logout' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-light me-2">Kijelentkez√©s</button>
                </form>
            </div>
        </div>
    </div>
</header>

<!-- √úZENETEK -->
{% if messages %}
<div class="container mt-2">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
</div>
{% endif %}

<!-- TARTALOM -->
<main class="container py-4">
        <div class="row">
            <div class="col-lg-9 col-md-8">
                {% block content %}{% endblock %}
            </div>
            
            {% if not is_ad_free %}
            <div class="col-lg-3 col-md-4 mt-4 mt-md-0">
                {% include 'billing/includes/ad_sidebar.html' %}
            </div>
            {% endif %}
        </div>
</main>

<footer class="py-3 my-4">
        {% if not is_ad_free %}
            {% include 'billing/includes/ad_footer.html' %}
        {% endif %}
        <p class="text-center text-muted">¬© 2025 digiTTrain</p>
</footer>

{% load ditta_tags %}
{% render_ditta %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{% block extra_js %}{% endblock %}

<script>
  console.log("üì¶ Base.html bet√∂ltve ‚Äì most jQuery-teszt j√∂n...");
  if (typeof $ !== "undefined") {
      console.log("‚úÖ jQuery m≈±k√∂dik! Verzi√≥:", $.fn.jquery);
  } else {
      console.error("‚ùå jQuery NEM m≈±k√∂dik! A $ v√°ltoz√≥ undefined!");
  }
</script>
</body>
</html>
