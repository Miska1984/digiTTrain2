{% load static %}
{% load user_extras %}
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}digiTTrain{% endblock %}</title>

    <!-- Frameworkek -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7737967729637742"
     crossorigin="anonymous"></script>

    {% block extra_css %}{% endblock %}
</head>

<body>
<header class="p-3 bg-dark text-white shadow">
    <div class="container">
        <div class="d-flex flex-wrap align-items-center justify-content-between">
            <!-- LOGO -->
            <a class="navbar-brand d-flex align-items-center text-white text-decoration-none" href="{% url 'core:main_page' %}">
                <img src="{% static 'images/your_logo.png' %}" alt="Logo" style="height: 50px;">
                <span class="ms-2 fw-bold"></span>
            </a>

            <!-- NAVIG√ÅCI√ì -->
            <ul class="nav mb-2 justify-content-center mb-md-0">

                <!-- VEZ√âRL≈êPULT -->
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="mainDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-cogs me-1"></i> Vez√©rl≈ëpult
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'users:role_dashboard' %}">Szerepk√∂r√∂k kezel√©se</a></li>
                        <li><a class="dropdown-item" href="{% url 'users:pending_roles' %}">J√≥v√°hagy√°sok</a></li>
                        <li><a class="dropdown-item" href="{% url 'data_sharing:sharing_center' %}">Megoszt√°si k√∂zpont</a></li>
                    </ul>
                </li>

                <!-- SPORTOL√ì FUNKCI√ìK -->
                {% if request.user|has_role:"Sportol√≥" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="athleteDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-running me-1"></i> Sportol√≥
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'biometric_data:athlete_dashboard' %}">Adat √ñsszefoglal√≥</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:morning_check' %}">Reggeli m√©r√©sek</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:after_training' %}">Esti m√©r√©sek</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:occasional_measurements' %}">Eseti m√©r√©sek</a></li>
                        <li><a class="dropdown-item" href="{% url 'biometric_data:add_running_performance' %}">Fut√°s teljes√≠tm√©ny</a></li>
                        <li><a class="dropdown-item" href="{% url 'ml_engine:dashboard' %}">Forma El≈ërejelz√©s</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- SZ√úL≈ê FUNKCI√ìK -->
                {% if request.user|has_role:"Sz√ºl≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="parentDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-child me-1"></i> Sz√ºl≈ë
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'data_sharing:parent_dashboard' %}">Gyermek(ek) adatai</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- EDZ≈ê FUNKCI√ìK -->
                {% if request.user|has_role:"Edz≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="coachDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-user-tie me-1"></i> Edz≈ë
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'data_sharing:add_unregistered_athlete' %}">Sportol√≥ felvitele</a></li>
                        <li><a class="dropdown-item" href="{% url 'data_sharing:coach_dashboard' %}">Sportol√≥im</a></li>
                        <li><a class="dropdown-item" href="{% url 'data_sharing:manage_schedules' %}">Edz√©s tervez√©s</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- EGYES√úLETI VEZET≈ê FUNKCI√ìK -->
                {% if request.user|has_role:"Egyes√ºleti vezet≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="leaderDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-crown me-1"></i> Egyes√ºleti Vezet≈ë
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'data_sharing:leader_dashboard' %}">Biometrikus adatok</a></li>
                    </ul>
                </li>
                {% endif %}

                <!-- G√âPI L√ÅT√ÅS FUNKCI√ìK (csak Sportol√≥) -->
                {% if request.user|has_any_role:"Sportol√≥,Edz≈ë,Sz√ºl≈ë,Egyes√ºleti vezet≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="diagnosticsDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-eye me-1"></i> G√©pi l√°t√°s
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li>
                            <a class="dropdown-item" href="{% url 'diagnostics:athlete_diagnostics' %}">
                                <i class="fas fa-brain me-2 text-info"></i> √Åltal√°nos elemz√©s
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="{% url 'diagnostics_jobs:anthropometry_profile_view' %}">
                                <i class="fas fa-ruler-combined"></i> Antropometriai Profil
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="#">
                                <i class="fas fa-video me-2 text-success"></i> √Åltal√°nos elemz√©s (vide√≥ felt√∂lt√©se lenne de m√°r nem kell)
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <a class="dropdown-item disabled text-muted" href="#">
                                <i class="fas fa-dumbbell me-2"></i> Sportspecifikus elemz√©sek (fejleszt√©s alatt)
                            </a>
                        </li>
                    </ul>
                </li>
                {% endif %}

                <!-- P√âNZ√úGYEK -->
                {% if request.user|has_any_role:"Sportol√≥,Edz≈ë,Sz√ºl≈ë,Egyes√ºleti vezet≈ë" %}
                <li class="nav-item dropdown me-3">
                    <a class="nav-link px-2 text-white dropdown-toggle" href="#" id="billingDropdown" role="button" data-bs-toggle="dropdown">
                        <i class="fas fa-wallet me-1"></i> P√©nz√ºgyek
                    </a>
                    <ul class="dropdown-menu dropdown-menu-dark">
                        <li><a class="dropdown-item" href="{% url 'billing:billing_dashboard' %}">P√©nz√ºgyi vez√©rl≈ëpult</a></li>
                        <li><a class="dropdown-item" href="{% url 'billing:billing_purchase' %}">V√°s√°rl√°s</a></li>
                        <li><a class="dropdown-item" href="{% url 'billing:ad_credit_earn' %}">Ingyenes elemz√©s (Hirdet√©s)</a></li>
                    </ul>
                </li>
                {% endif %}
            </ul>

            <!-- PROFIL + KIJELENTKEZ√âS -->
            <div class="text-end d-flex align-items-center">
                <a href="{% url 'users:edit_profile' %}" class="nav-link text-white me-3">
                    <i class="bi bi-person-circle h4"></i>
                </a>
                <form action="{% url 'users:logout' %}" method="post" class="d-inline">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-outline-light me-2">Kijelentkez√©s</button>
                </form>
            </div>
        </div>
    </div>
</header>

<!-- √úZENETEK -->
{% if messages %}
<div class="container mt-2">
    {% for message in messages %}
        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    {% endfor %}
</div>
{% endif %}

<!-- TARTALOM -->
<main class="container py-4">
    <div class="row">
        <div class="col-lg-9 col-md-8">{% block content %}{% endblock %}</div>
        <div class="col-lg-3 col-md-4 mt-4 mt-md-0">{% include 'billing/includes/ad_sidebar.html' %}</div>
    </div>
</main>

<footer class="py-3 my-4">
    {% include 'billing/includes/ad_footer.html' %}
    <p class="text-center text-muted">¬© 2025 digiTTrain</p>
</footer>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

{% block extra_js %}{% endblock %}

<script>
  console.log("üì¶ Base.html bet√∂ltve ‚Äì most jQuery-teszt j√∂n...");
  if (typeof $ !== "undefined") {
      console.log("‚úÖ jQuery m≈±k√∂dik! Verzi√≥:", $.fn.jquery);
  } else {
      console.error("‚ùå jQuery NEM m≈±k√∂dik! A $ v√°ltoz√≥ undefined!");
  }
</script>
</body>
</html>
