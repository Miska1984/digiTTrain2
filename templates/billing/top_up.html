{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Credit Feltöltés & Számlaigénylés{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">
        <i class="bi bi-currency-dollar me-2"></i> Credit Feltöltés & Számlaigénylés
    </h1>

    <div class="row">
        
        {# ------------------ FELTÖLTÉSI ŰRLAP ------------------ #}
        <div class="col-lg-8 mb-4">
            <div class="card shadow p-4">
                <h2 class="text-2xl font-semibold mb-4 text-indigo-700">1. Feltöltési Kérelem Létrehozása</h2>
                <p class="text-muted mb-4">Adja meg a feltöltendő összeget, és kérje el a számlázási adatokat. A Credit a fizetés beérkezése után kerül jóváírásra.</p>
                
                <form method="post" novalidate>
                    {% csrf_token %}

                    <div class="row g-3 mb-4">
                        {# Összeg #}
                        <div class="col-md-6">
                            <label for="{{ form.amount_ft.id_for_label }}" class="form-label">{{ form.amount_ft.label }}</label>
                            {% render_field form.amount_ft class+="form-control form-control-lg" %}
                            <div class="form-text">{{ form.amount_ft.help_text }}</div>
                            {% for error in form.amount_ft.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        </div>

                        {# Célfelhasználó #}
                        <div class="col-md-6">
                            <label for="{{ form.target_user.id_for_label }}" class="form-label">{{ form.target_user.label }}</label>
                            {% render_field form.target_user class+="form-select form-control-lg" %}
                            <div class="form-text">{{ form.target_user.help_text }}</div>
                            {% for error in form.target_user.errors %}
                                <div class="text-danger small">{{ error }}</div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <h3 class="text-xl font-semibold mb-3 text-gray-700 border-top pt-3">2. Számlázási Adatok</h3>

                    <div class="mb-3">
                        <label for="{{ form.billing_name.id_for_label }}" class="form-label">{{ form.billing_name.label }}</label>
                        {% render_field form.billing_name class+="form-control" %}
                        {% for error in form.billing_name.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-3">
                        <label for="{{ form.billing_address.id_for_label }}" class="form-label">{{ form.billing_address.label }}</label>
                        {% render_field form.billing_address class+="form-control" %}
                        {% for error in form.billing_address.errors %}
                            <div class="text-danger small">{{ error }}</div>
                        {% endfor %}
                    </div>
                    
                    <div class="mb-4">
                        <label for="{{ form.tax_number.id_for_label }}" class="form-label">{{ form.tax_number.label }}</label>
                        {% render_field form.tax_number class+="form-control" %}
                        <div class="form-text">{{ form.tax_number.help_text }}</div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg w-100">
                        <i class="bi bi-file-earmark-text me-1"></i> Számlaigénylés Rögzítése
                    </button>
                </form>
            </div>
        </div>

        {# ------------------ FÜGGŐBEN LÉVŐ IGÉNYEK ------------------ #}
        <div class="col-lg-4">
            <div class="card shadow p-4 bg-light">
                <h2 class="text-2xl font-semibold mb-4 text-indigo-700">Függőben Lévő Kérelmek</h2>
                
                {% if pending_invoices %}
                    <ul class="list-group list-group-flush">
                        {% for invoice in pending_invoices %}
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h5 class="mb-1 text-primary">{{ invoice.amount_ft|floatformat:0 }} Ft</h5>
                                    <p class="mb-1 small text-muted">Cél: <strong>{{ invoice.target_user.username }}</strong></p>
                                    <p class="mb-0 small text-danger">Függőben: Várjuk az utalást!</p>
                                </div>
                                <span class="badge bg-secondary rounded-pill">{{ invoice.request_date|date:"Y.m.d" }}</span>
                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <div class="alert alert-info">Nincs függőben lévő számlaigénylése.</div>
                {% endif %}
                
                <hr class="my-3">
                <p class="small text-muted">A fizetés részleteit a kérelem elküldése után kapja meg e-mailben.</p>
            </div>
        </div>
    </div>

</div>
{% endblock content %}