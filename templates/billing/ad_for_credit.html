{% extends 'base.html' %}
{% load static %}

{% block title %}Ingyenes Elemz√©s Szerz√©s - DigiTTrain{% endblock %}

{% block content %}
<div class="container-fluid">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">
        <i class="bi bi-gift-fill me-2"></i> Ingyenes Elemz√©s Szerz√©se
    </h1>

    <div class="row justify-content-center">
        
        {# F≈ê TARTALOM OSZLOP #}
        <div class="col-lg-8">
            
            {# SOROZAT ST√ÅTUSZ K√ÅRTYA #}
            <div class="card shadow mb-4">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">
                        <i class="bi bi-calendar-check me-2"></i> 5 Napos Hirdet√©sn√©z√©si Kih√≠v√°s
                    </h4>
                </div>
                <div class="card-body text-center">
                    <div class="mb-4">
                        <h2 class="display-4 fw-bold text-info">{{ current_streak }}/5 nap</h2>
                        <p class="lead text-muted">
                            {% if current_streak >= 5 %}
                                üéâ Gratul√°lunk! El√©rted az 5 napot!
                            {% else %}
                                M√©g {{ remaining_days }} nap √©s kapsz +1 ingyenes elemz√©st!
                            {% endif %}
                        </p>
                    </div>
                    
                    {# PROGRESS BAR #}
                    <div class="progress mb-4" style="height: 30px;">
                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                             role="progressbar" 
                             style="width: {{ current_streak|floatformat:0 }}0%;" 
                             aria-valuenow="{{ current_streak }}" 
                             aria-valuemin="0" 
                             aria-valuemax="5">
                            {{ current_streak }}/5 nap teljes√≠tve
                        </div>
                    </div>
                    
                    {# JUTALOM LE√çR√ÅSA #}
                    <div class="alert alert-success">
                        <h5 class="alert-heading">
                            <i class="bi bi-trophy-fill me-2"></i> Jutalom
                        </h5>
                        <p class="mb-0">
                            <strong>+1 ingyenes elemz√©s</strong> automatikusan hozz√°ad√≥dik az egyenlegedhez 
                            5 egym√°st k√∂vet≈ë nap hirdet√©sn√©z√©se ut√°n!
                        </p>
                    </div>
                </div>
            </div>
            
            {# HIRDET√âS FEL√úLET #}
            <div class="card shadow p-4 mb-4 text-center">
                {% if can_view_today %}
                    <h2 class="text-2xl font-semibold mb-3 text-primary">
                        <i class="bi bi-play-circle-fill me-2"></i> N√©zz meg egy r√∂vid hirdet√©st!
                    </h2>
                    
                    <p class="text-muted mb-4">
                        K√©rj√ºk, tekintsd meg a hirdet√©st a t√°mogat√°sunk√©rt. Minden nap sz√°m√≠t! üìÖ
                    </p>
                    
                    {# ------------------ HIRDET√âS PLACEHOLDER ------------------ #}
                    <div class="ad-container bg-light p-5 border border-primary rounded mb-5 mx-auto" style="max-width: 600px;">
                        
                        {# IDE J√ñN A GOOGLE ADSENSE K√ìD #}
                        <ins class="adsbygoogle"
                             style="display:block"
                             data-ad-client="ca-pub-7737967729637742"
                             data-ad-slot="1234567890"
                             data-ad-format="auto"
                             data-full-width-responsive="true"></ins>
                        <script>
                             (adsbygoogle = window.adsbygoogle || []).push({});
                        </script>
                        
                        <div class="mt-3">
                            <i class="bi bi-camera-video-fill display-3 text-primary"></i>
                            <p class="mt-3 fs-5 fw-bold text-primary">HIRDET√âS BET√ñLT√âS alatt...</p>
                            <p class="small text-muted">A hirdet√©s automatikusan elindul. K√©rj√ºk, v√°rja meg a v√©g√©t (kb. 15-30 m√°sodperc).</p>
                        </div>
                    </div>
                    
                    {# ------------------ MEGER≈êS√çT≈ê GOMB ------------------ #}
                    <div id="confirmSection">
                        <p class="lead fw-bold text-success mb-4">
                            <i class="bi bi-check-circle-fill me-1"></i> Megn√©zted a hirdet√©st?
                        </p>
                        
                        <form method="post" action="{% url 'billing:ad_credit_earn' %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-success btn-lg px-5">
                                <i class="bi bi-check2-circle me-2"></i> Igen, megn√©ztem!
                            </button>
                        </form>
                        
                        <p class="small text-muted mt-3">
                            A meger≈ës√≠t√©s ut√°n automatikusan r√∂gz√≠tj√ºk a mai napot a sorozatodban.
                        </p>
                    </div>
                {% else %}
                    {# MA M√ÅR N√âZETT HIRDET√âST #}
                    <div class="alert alert-info">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        <strong>Ma m√°r megn√©zted a hirdet√©st!</strong>
                    </div>
                    <p class="text-muted">Gyere vissza holnap, hogy folytasd a sorozatodat! üóìÔ∏è</p>
                    
                    <a href="{% url 'billing:billing_dashboard' %}" class="btn btn-primary mt-3">
                        <i class="bi bi-arrow-left me-1"></i> Vissza a Vez√©rl≈ëpultra
                    </a>
                {% endif %}
                
            </div>
            
            {# SZAB√ÅLYOK #}
            <div class="card shadow p-4 bg-light">
                <h3 class="text-xl font-semibold mb-3">
                    <i class="bi bi-info-circle-fill me-2"></i> Hogyan m≈±k√∂dik?
                </h3>
                <ol class="list-group list-group-numbered">
                    <li class="list-group-item">N√©zz meg <strong>1 hirdet√©st naponta</strong> üì∫</li>
                    <li class="list-group-item">Tedd ezt meg <strong>5 egym√°st k√∂vet≈ë napon</strong> kereszt√ºl üìÖ</li>
                    <li class="list-group-item">Az 5. nap ut√°n <strong>automatikusan kapsz +1 ingyenes elemz√©st</strong> üéÅ</li>
                    <li class="list-group-item">A sorozat √∫jraindul, √©s √∫jra kezdheted! üîÑ</li>
                </ol>
                <p class="text-muted small mt-3">
                    <i class="bi bi-exclamation-triangle me-1"></i> Ha kihagysz egy napot, a sorozat null√°z√≥dik √©s el√∂lr≈ël kell kezdened.
                </p>
            </div>
            
            <a href="{% url 'billing:billing_dashboard' %}" class="btn btn-outline-secondary mt-4">
                <i class="bi bi-arrow-left me-1"></i> Vissza a P√©nz√ºgyi Vez√©rl≈ëpultra
            </a>
            
        </div>
        
    </div>
</div>

{% endblock content %}

{% block extra_js %}
<script>
    // Opcion√°lis: Timer vagy egy√©b valid√°ci√≥ a hirdet√©s megtekint√©s√©re
    // Jelenleg a gomb mindig akt√≠v, de lehet id≈ëz√≠t≈ët hozz√°adni
    
    document.addEventListener('DOMContentLoaded', function() {
        console.log('‚úÖ Hirdet√©sn√©z√©si oldal bet√∂ltve');
        
        // P√©lda: 15 m√°sodperc ut√°n enged√©lyezni a gombot (opcion√°lis)
        // const submitButton = document.querySelector('button[type="submit"]');
        // if (submitButton) {
        //     submitButton.disabled = true;
        //     setTimeout(() => {
        //         submitButton.disabled = false;
        //         submitButton.textContent = '‚úÖ Igen, megn√©ztem!';
        //     }, 15000); // 15 m√°sodperc
        // }
    });
</script>
{% endblock extra_js %}