{% extends "base.html" %}
{% load static %}

{% block title %}Szülői Dashboard{% endblock %}

{% block content %}
<div class="container">
    <h2 class="mb-4">Gyermekeim adatai</h2>

    <!-- Szűrő -->
    <form method="get" class="mb-4">
        <label for="child_id">Gyermek kiválasztása:</label>
        <select name="child_id" id="child_id" class="form-select" onchange="this.form.submit()">
            <option value="">Összes gyermek</option>
            {% for role in child_roles %}
                <option value="{{ role.user.id }}" {% if selected_child_id == role.user.id %}selected{% endif %}>
                    {{ role.user.profile.first_name }} {{ role.user.profile.last_name }}
                </option>
            {% endfor %}
        </select>
    </form>

    {% if children_data %}
        <div class="row">
            {% for child in children_data %}
                <div class="col-md-12 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-primary text-white">
                            <strong>{{ child.role.user.profile.first_name }} {{ child.role.user.profile.last_name }}</strong>
                            – {{ child.role.sport.name }} ({{ child.role.club.short_name }})
                        </div>
                        <div class="card-body">
                            <!-- Súlyadatok -->
                            <h5>Súlyadatok (utolsó 5)</h5>
                            {% if child.weight_data %}
                                <ul>
                                    {% for data in child.weight_data %}
                                        <li>{{ data.workout_date }} – {{ data.morning_weight }} kg</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-muted">Nincs adat.</p>
                            {% endif %}

                            <!-- HRV és alvás -->
                            <h5 class="mt-3">HRV és Alvás (utolsó 5)</h5>
                            {% if child.hrv_sleep_data %}
                                <ul>
                                    {% for data in child.hrv_sleep_data %}
                                        <li>{{ data.recorded_at }} – HRV: {{ data.hrv }} ms, Alvás: {{ data.sleep_quality }}/10</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-muted">Nincs adat.</p>
                            {% endif %}

                            <!-- Edzésvisszajelzés -->
                            <h5 class="mt-3">Edzés visszajelzés</h5>
                            {% if child.feedback_data %}
                                <ul>
                                    {% for data in child.feedback_data %}
                                        <li>{{ data.workout_date }} – Marokerő: {{ data.right_grip_strength }} / {{ data.left_grip_strength }} kg, Intenzitás: {{ data.workout_intensity }}/10</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-muted">Nincs adat.</p>
                            {% endif %}

                            <!-- Futóteljesítmény -->
                            <h5 class="mt-3">Futó teljesítmény</h5>
                            {% if child.running_data %}
                                <ul>
                                    {% for data in child.running_data %}
                                        <li>{{ data.run_date }} – {{ data.run_distance_km }} km, Idő: {{ data.run_duration }}, Átlag pulzus: {{ data.run_avg_hr }}</li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-muted">Nincs adat.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">Nincs jóváhagyott gyermek.</p>
    {% endif %}
</div>
{% endblock %}
