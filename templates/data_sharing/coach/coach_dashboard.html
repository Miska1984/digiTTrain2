{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto p-4">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-bold text-gray-800">Sportolóim Áttekintője</h1>
        <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm font-semibold">
            {{ athletes_data|length }} Versenyző
        </span>
    </div>
    
    {% if athletes_data %}
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {% for data in athletes_data %}
                <div class="bg-white shadow-lg rounded-xl p-6 border-t-4 border-blue-500 hover:shadow-2xl transition duration-300 flex flex-col h-100">
                    
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 class="text-xl font-bold text-blue-900">
                                {{ data.profile_data.first_name }} {{ data.profile_data.last_name }}
                            </h2>
                            <p class="text-xs text-gray-500 uppercase tracking-wider font-semibold">
                                {{ data.athlete_club.name }} | {{ data.athlete_sport.name }}
                            </p>
                        </div>

                        {# AI READYNESS BADGE - Csak ha van rá jog #}
                        {% if 'UserFeatureSnapshot' in data.permissions %}
                            <div class="text-center bg-gray-50 p-2 rounded-lg border">
                                <span class="block text-xs text-gray-500 font-bold uppercase">Ditta AI</span>
                                <span class="text-lg font-black {% if data.ditta_score.readiness_index > 70 %}text-green-600{% else %}text-orange-500{% endif %}">
                                    {{ data.ditta_score.readiness_index|default:"--" }}%
                                </span>
                            </div>
                        {% endif %}
                    </div>

                    <div class="space-y-3 mb-6 flex-grow">
                        {% if 'WeightData' in data.permissions %}
                        <div class="flex justify-between items-center text-sm border-b border-gray-50 pb-2">
                            <span class="text-gray-600">Utolsó súly:</span>
                            <span class="font-bold text-gray-800">{{ data.last_weight.morning_weight|default:"--" }} kg</span>
                        </div>
                        {% endif %}

                        {% if 'Attendance' in data.permissions and data.attendance_stats %}
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-600">Jelenlét (30 nap):</span>
                            <span class="px-2 py-0.5 rounded bg-green-100 text-green-700 font-bold">
                                {{ data.attendance_stats.percent }}%
                            </span>
                        </div>
                        {% endif %}
                    </div>

                    {# Ikonok jelzik, mihez van jog #}
                    <div class="mt-4">
                        <p class="text-[10px] uppercase text-gray-400 font-bold mb-2 tracking-widest">Megosztott adatok és állapot</p>
                        
                        <div class="grid grid-cols-4 gap-3 bg-gray-50 p-3 rounded-xl border border-gray-100">
                            
                            {# 1. Testsúly #}
                            <div class="flex flex-col items-center" title="Testsúly adatok">
                                <i class="fas fa-weight-hanging text-lg {% if 'WeightData' in data.permissions %}text-blue-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'WeightData' in data.permissions %}text-blue-700 font-bold{% else %}text-gray-400{% endif %}">Súly</span>
                            </div>

                            {# 2. HRV / Alvás #}
                            <div class="flex flex-col items-center" title="HRV és Alvás adatok">
                                <i class="fas fa-heartbeat text-lg {% if 'HRVandSleepData' in data.permissions %}text-red-400{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'HRVandSleepData' in data.permissions %}text-red-700 font-bold{% else %}text-gray-400{% endif %}">HRV</span>
                            </div>

                            {# 3. Jelenlét #}
                            <div class="flex flex-col items-center" title="Edzéslátogatás és jelenlét">
                                <i class="fas fa-calendar-check text-lg {% if 'Attendance' in data.permissions %}text-green-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'Attendance' in data.permissions %}text-green-700 font-bold{% else %}text-gray-400{% endif %}">Jelenlét</span>
                            </div>

                            {# 4. Ditta AI Forma #}
                            <div class="flex flex-col items-center" title="Aktuális forma és állapot (AI)">
                                <i class="fas fa-robot text-lg {% if 'UserFeatureSnapshot' in data.permissions %}text-purple-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'UserFeatureSnapshot' in data.permissions %}text-purple-700 font-bold{% else %}text-gray-400{% endif %}">Forma</span>
                            </div>

                            {# 5. Diagnosztika #}
                            <div class="flex flex-col items-center" title="Mozgáselemzési diagnosztika">
                                <i class="fas fa-microscope text-lg {% if 'DiagnosticJob' in data.permissions %}text-teal-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'DiagnosticJob' in data.permissions %}text-teal-700 font-bold{% else %}text-gray-400{% endif %}">DittaScan</span>
                            </div>

                            {# 6. Előrejelzés #}
                            <div class="flex flex-col items-center" title="Teljesítmény előrejelzés">
                                <i class="fas fa-magic text-lg {% if 'UserPredictionResult' in data.permissions %}text-yellow-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'UserPredictionResult' in data.permissions %}text-yellow-700 font-bold{% else %}text-gray-400{% endif %}">Jóslat</span>
                            </div>

                            {# 7. Edzés visszajelzés #}
                            <div class="flex flex-col items-center" title="Edzés visszajelzések">
                                <i class="fas fa-comment-dots text-lg {% if 'WorkoutFeedback' in data.permissions %}text-indigo-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'WorkoutFeedback' in data.permissions %}text-indigo-700 font-bold{% else %}text-gray-400{% endif %}">Feedback</span>
                            </div>

                            {# 8. Futás #}
                            <div class="flex flex-col items-center" title="Futóteljesítmény">
                                <i class="fas fa-running text-lg {% if 'RunningPerformance' in data.permissions %}text-orange-500{% else %}text-gray-300{% endif %}"></i>
                                <span class="text-[9px] mt-1 {% if 'RunningPerformance' in data.permissions %}text-orange-700 font-bold{% else %}text-gray-400{% endif %}">Futás</span>
                            </div>

                        </div>
                    </div>

                    <a href="{% url 'data_sharing:athlete_details' athlete_id=data.athlete_object.id role_id=data.role_id %}"
                       class="mt-auto w-full block text-center bg-blue-600 text-white py-3 px-4 rounded-xl font-bold hover:bg-blue-700 shadow-md transition duration-300">
                        Részletek megnyitása
                    </a>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="bg-white border border-gray-200 rounded-xl p-10 text-center shadow-sm">
            <h3 class="text-xl font-bold text-gray-800">Még nincsenek sportolói.</h3>
            <p class="text-gray-500">A sportolóknak jóvá kell hagyniuk az edzői felkérést.</p>
        </div>
    {% endif %}
</div>
{% endblock %}